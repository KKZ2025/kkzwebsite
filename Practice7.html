<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Castle Treasure Hunt - AI Enhanced Practice</title>
    <style>
        /* CSS remains identical to maintain your UI */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex; flex-direction: column; align-items: center;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            margin: 0; padding: 20px; min-height: 100vh; color: #333;
        }
        .container {
            width: 100%; max-width: 1000px; background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); overflow: hidden; position: relative;
        }
        header { background: linear-gradient(to right, #4CAF50, #2E8B57); color: white; padding: 20px; text-align: center; }
        .game-area { padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .game-container {
            width: fit-content; max-width: 100%; height: auto; border: 5px solid #4CAF50;
            position: relative; overflow: hidden; margin-bottom: 20px; border-radius: 10px; background: #fff;
        }
        .background-img { display: block; max-width: 100%; max-height: 75vh; height: auto; position: relative; z-index: 1; }
        .warrior-char { width: 120px; height: auto; position: absolute; z-index: 10; transition: all 2.5s ease-in-out; }
        #warrior2 { width: 160px; }
        #warrior4 { width: 220px; transition: transform 0.6s ease-out, left 2.5s, bottom 2.5s; }
        #warrior6 { width: 220px; }
        .input-area { display: flex; gap: 10px; margin-top: 15px; width: 100%; justify-content: center; }
        .answer-input { padding: 12px; font-size: 16px; width: 350px; border: 2px solid #4CAF50; border-radius: 5px; outline: none; }
        .submit-btn { padding: 12px 24px; font-size: 16px; background: linear-gradient(to bottom, #4CAF50, #2E8B57); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .message { margin-top: 15px; font-size: 18px; min-height: 50px; text-align: center; font-weight: bold; max-width: 80%; line-height: 1.4; }
        .level-indicator { font-size: 24px; margin-bottom: 15px; font-weight: bold; color: #2E8B57; }
        .progress-container { width: 100%; background-color: #e0e0e0; border-radius: 10px; margin-bottom: 20px; height: 20px; overflow: hidden; }
        .progress-bar { height: 100%; background: linear-gradient(to right, #4CAF50, #2E8B57); width: 0%; transition: width 0.5s ease; }
        .instructions { background-color: #f1f8e9; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #4CAF50; width: 100%; }
        .success-message { text-align: center; font-size: 28px; color: #2E8B57; margin: 20px 0; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Castle Treasure Hunt</h1>
            <div class="subtitle">Compound Directional Complement Practice</div>
        </header>
        
        <div class="game-area">
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <div class="level-indicator" id="level-indicator">Level 1</div>
            
            <div class="instructions">
                <h3>The Mission:</h3>
                <p>Use your Chinese skills to guide the warrior. Type your command as a phrase or a full sentence!</p>
            </div>
            
            <!-- Level 1 -->
            <div id="level1" class="tab-content active">
                <div class="game-container">
                    <img class="background-img" src="https://github.com/KKZ2025/kkzwebsite/blob/main/images/game7/level1-bg.JPG?raw=true">
                    <img class="warrior-char" id="warrior1" src="https://github.com/KKZ2025/kkzwebsite/blob/main/images/game7/warrior1.png?raw=true">
                </div>
                <div class="input-area"><input type="text" class="answer-input" id="answer1" placeholder="Enter your command..."><button class="submit-btn" id="submit1">Submit</button></div>
                <div class="message" id="message1"></div>
            </div>
            
            <!-- Level 2 -->
            <div id="level2" class="tab-content" style="display: none;">
                <div class="game-container">
                    <img class="background-img" src="https://github.com/KKZ2025/kkzwebsite/blob/main/images/game7/level2-bg.JPG?raw=true">
                    <img class="warrior-char" id="warrior2" src="https://github.com/KKZ2025/kkzwebsite/blob/main/images/game7/warrior2.png?raw=true">
                </div>
                <div class="input-area"><input type="text" class="answer-input" id="answer2" placeholder="Enter your command..."><button class="submit-btn" id="submit2">Submit</button></div>
                <div class="message" id="message2"></div>
            </div>

            <!-- Level 3 -->
            <div id="level3" class="tab-content" style="display: none;">
                <div class="game-container">
                    <img class="background-img" src="https://github.com/KKZ2025/kkzwebsite/blob/main/images/game7/level3-bg.JPG?raw=true">
                    <img class="warrior-char" id="warrior3" src="https://github.com/KKZ2025/kkzwebsite/blob/main/images/game7/warrior3.png?raw=true">
                </div>
                <div class="input-area"><input type="text" class="answer-input" id="answer3" placeholder="Enter your command..."><button class="submit-btn" id="submit3">Submit</button></div>
                <div class="message" id="message3"></div>
            </div>

            <!-- Level 4 -->
            <div id="level4" class="tab-content" style="display: none;">
                <div class="game-container">
                    <img class="background-img" src="https://github.com/KKZ2025/kkzwebsite/blob/main/images/game7/level4-bg.PNG?raw=true">
                    <img class="warrior-char" id="warrior4" src="https://github.com/KKZ2025/kkzwebsite/blob/main/images/game7/warrior4.png?raw=true">
                </div>
                <div class="input-area"><input type="text" class="answer-input" id="answer4" placeholder="Enter your command..."><button class="submit-btn" id="submit4">Execute</button></div>
                <div class="message" id="message4"></div>
            </div>

            <!-- Level 5 -->
            <div id="level5" class="tab-content" style="display: none;">
                <div class="game-container">
                    <img class="background-img" src="https://github.com/KKZ2025/kkzwebsite/blob/main/images/game7/level5-bg.JPG?raw=true">
                    <img class="warrior-char" id="warrior5" src="https://github.com/KKZ2025/kkzwebsite/blob/main/images/game7/warrior5.png?raw=true">
                </div>
                <div class="input-area"><input type="text" class="answer-input" id="answer5" placeholder="Enter your command..."><button class="submit-btn" id="submit5">Execute</button></div>
                <div class="message" id="message5"></div>
            </div>

            <!-- Level 6 -->
            <div id="level6" class="tab-content" style="display: none;">
                <div class="game-container" id="game-container6">
                    <img class="background-img" src="https://github.com/KKZ2025/kkzwebsite/blob/main/images/game7/level6-bg.JPG?raw=true">
                    <img class="warrior-char" id="warrior6" src="https://github.com/KKZ2025/kkzwebsite/blob/main/images/game7/warrior6.png?raw=true">
                </div>
                <div class="input-area"><input type="text" class="answer-input" id="answer6" placeholder="Enter your command..."><button class="submit-btn" id="submit6">Execute</button></div>
                <div class="message" id="message6"></div>
            </div>
            
            <div id="level-complete" class="tab-content" style="display: none;">
                <div class="success-message">Mastered! You are a Directional Complement Expert!</div>
                <div style="text-align: center;"><img src="https://github.com/KKZ2025/kkzwebsite/blob/main/images/game7/warrior6.png?raw=true" style="width: 250px;"></div>
            </div>
        </div>
    </div>

    <script>
        const levelLogic = {
            1: { targets: ['Ëµ∞ËøõÂéª', 'Ë∑ëËøõÂéª'], verbs: ['Ëµ∞', 'Ë∑ë'], dir: 'Ëøõ', end: 'Âéª', goal: "enter the castle" },
            2: { targets: ['Ëµ∞‰∏äÂéª', 'Ë∑ë‰∏äÂéª'], verbs: ['Ëµ∞', 'Ë∑ë'], dir: '‰∏ä', end: 'Âéª', goal: "go up the stairs" },
            3: { targets: ['Ë∑ëËøáÂéª', 'ÂÜ≤ËøáÂéª'], verbs: ['Ë∑ë', 'ÂÜ≤'], dir: 'Ëøá', end: 'Âéª', goal: "move across to the cabinet" },
            4: { targets: ['Ë∑≥Ëµ∑Êù•'], verbs: ['Ë∑≥'], dir: 'Ëµ∑', end: 'Êù•', goal: "reach the top of the closet" }, 
            5: { targets: ['Ëµ∞ËøáÂéª', 'Ë∑ëËøáÂéª'], verbs: ['Ëµ∞', 'Ë∑ë'], dir: 'Ëøá', end: 'Âéª', goal: "walk across to the table" },
            6: { targets: ['ÊãøÂá∫Êù•', 'ÂèñÂá∫Êù•'], verbs: ['Êãø', 'Âèñ'], dir: 'Âá∫', end: 'Êù•', goal: "take the treasure out" }
        };

        const gameState = { currentLevel: 1, totalLevels: 6, completedLevels: 0 };

        function getAIResponse(input, levelNum) {
            const val = input.trim();
            const logic = levelLogic[levelNum];
            
            if (logic.targets.some(t => val.includes(t))) return "SUCCESS";
            if (val === "") return "The warrior is standing by for your command!";

            // Narrative / Strategy
            if (levelNum === 3 && val.includes("Ëµ∞ËøáÂéª")) {
                return "Your grammar is spot on! However, look at that dog! üêï If the warrior only walks, he won't be fast enough. Can you think of a more urgent action verb?";
            }
            if (levelNum === 4 && val.includes("Áà¨‰∏äÂéª")) {
                return "Clever thinking! Usually that would work, but the surface is too slippery to climb! üßä Can you think of a more explosive way to reach the top?";
            }

            const hasVerb = logic.verbs.some(v => val.includes(v));
            const hasDir = Array.isArray(logic.dir) ? logic.dir.some(d => val.includes(d)) : val.includes(logic.dir);
            const correctEnd = Array.isArray(logic.end) ? logic.end[0] : logic.end;
            const hasEnd = val.includes(correctEnd);
            const hasWrongEnd = val.includes(correctEnd === 'Âéª' ? 'Êù•' : 'Âéª');

            // --- CONTEXTUAL OPTIMIZATION ---
            // Student has Verb + Wrong Direction + Correct Perspective (e.g., Ëµ∞ËøáÂéª in Level 1)
            if (hasVerb && !hasDir && hasEnd) {
                return `Very close! You have the right action and perspective, but now you have to **${logic.goal}**. Try a different middle direction word!`;
            }

            // Simple Directional check (e.g., ËøõÂéª)
            if (!hasVerb && hasDir && hasEnd) {
                return "Spot on with the direction! Now, how does the warrior get there? (Walking? Running?). Add an action verb to the start!";
            }

            // Missing Perspective (e.g., Ëµ∞Ëøõ)
            if (hasVerb && hasDir && !hasEnd && !hasWrongEnd) {
                return "Nearly there! You have the action and the direction. Now, is he moving away from us or toward us? Add that final piece!";
            }

            // Perspective Error (e.g., mixing Êù•/Âéª)
            if (hasVerb && hasDir && hasWrongEnd) {
                return "Great structure! Just one check: look at the warrior's path. Is he heading away into the scene, or toward us? Adjust that last character!";
            }

            return "Not quite. Remember the pattern: [Action Verb] + [Direction] + [Perspective]. You're doing great!";
        }

        function showNext() {
            document.getElementById(`level${gameState.currentLevel}`).style.display = 'none';
            gameState.completedLevels++;
            document.getElementById('progress-bar').style.width = `${(gameState.completedLevels / gameState.totalLevels) * 100}%`;
            if (gameState.currentLevel < gameState.totalLevels) {
                gameState.currentLevel++;
                document.getElementById(`level${gameState.currentLevel}`).style.display = 'block';
                document.getElementById('level-indicator').textContent = `Level ${gameState.currentLevel}`;
            } else {
                document.getElementById('level-complete').style.display = 'block';
            }
        }

        function triggerLevel(levelNum, onWin) {
            const input = document.getElementById(`answer${levelNum}`).value;
            const msg = document.getElementById(`message${levelNum}`);
            const feedback = getAIResponse(input, levelNum);
            
            if (feedback === "SUCCESS") {
                msg.textContent = "Fantastic! That's the correct command!"; msg.style.color = "#2E8B57";
                onWin(input);
                setTimeout(showNext, 4000);
            } else { msg.textContent = feedback; msg.style.color = "#b21f1f"; }
        }

        // --- ANIMATIONS & POSITIONS ---
        const warrior1 = document.getElementById('warrior1');
        warrior1.style.left = '10%'; warrior1.style.bottom = '5%';
        document.getElementById('submit1').onclick = () => triggerLevel(1, () => warrior1.style.left = '55%');

        const warrior2 = document.getElementById('warrior2');
        warrior2.style.left = '10%'; warrior2.style.bottom = '5%';
        document.getElementById('submit2').onclick = () => triggerLevel(2, () => {
            warrior2.style.left = '70%'; warrior2.style.bottom = '60%';
        });

        const warrior3 = document.getElementById('warrior3');
        warrior3.style.left = '5%'; warrior3.style.bottom = '5%';
        document.getElementById('submit3').onclick = () => triggerLevel(3, () => warrior3.style.left = '80%');

        const warrior4 = document.getElementById('warrior4');
        warrior4.style.left = '15%'; warrior4.style.bottom = '5%';
        document.getElementById('submit4').onclick = () => triggerLevel(4, (val) => {
            if(val.includes("Ë∑≥")) {
                warrior4.style.transform = 'translateY(-380px)'; 
                setTimeout(() => warrior4.style.transform = 'translateY(0)', 600);
            }
        });

        const warrior5 = document.getElementById('warrior5');
        warrior5.style.left = '15%'; warrior5.style.bottom = '2%';
        document.getElementById('submit5').onclick = () => triggerLevel(5, () => warrior5.style.left = '75%');

        const warrior6 = document.getElementById('warrior6');
        warrior6.style.left = '55%'; warrior6.style.bottom = '5%';
        document.getElementById('submit6').onclick = () => triggerLevel(6, () => {
            warrior6.style.transform = 'scale(1.2)';
            createConfetti();
        });

        function createConfetti() {
            const container = document.getElementById('game-container6');
            const rect = container.getBoundingClientRect();
            for (let i = 0; i < 80; i++) {
                const c = document.createElement('div');
                c.style.position = 'absolute'; c.style.width = '10px'; c.style.height = '10px';
                c.style.backgroundColor = ['#ff0', '#f0f', '#0ff', '#f00'][Math.floor(Math.random()*4)];
                c.style.left = Math.random() * 100 + '%'; c.style.top = '-10px'; c.style.zIndex = '20';
                container.appendChild(c);
                c.animate([{ transform: 'translateY(0)', opacity: 1 }, { transform: `translateY(${rect.height}px)`, opacity: 0 }], 2000).onfinish = () => c.remove();
            }
        }

        document.querySelectorAll('.answer-input').forEach((el, i) => {
            el.onkeypress = (e) => { if(e.key === 'Enter') document.getElementById(`submit${i+1}`).click(); };
        });
    </script>
</body>
</html>
