<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Castle Treasure Hunt - Compound Directional Complement Practice</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            width: 100%;
            max-width: 1000px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            position: relative;
        }
        
        header {
            background: linear-gradient(to right, #4CAF50, #2E8B57);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        h1 {
            margin: 0;
            font-size: 32px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 18px;
            margin-top: 5px;
            opacity: 0.9;
        }
        
        .game-area {
            padding: 20px;
        }
        
        .game-container {
            width: 100%;
            height: 500px;
            border: 3px solid #4CAF50;
            position: relative;
            overflow: hidden;
            background-color: #e8f5e9;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.1);
        }
        
        .warrior {
            width: 120px;
            height: 180px;
            position: absolute;
            transition: all 2.5s ease-in-out;
            z-index: 2;
        }
        
        .castle {
            width: 400px;
            height: 350px;
            position: absolute;
            right: 50px;
            top: 100px;
            z-index: 1;
        }
        
        .staircase {
            width: 500px;
            height: 300px;
            position: absolute;
            right: 0;
            top: 150px;
            z-index: 1;
            display: none;
        }
        
        .background {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .input-area {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }
        
        .answer-input {
            padding: 12px;
            font-size: 16px;
            width: 300px;
            border: 2px solid #4CAF50;
            border-radius: 5px;
            outline: none;
            transition: all 0.3s;
        }
        
        .answer-input:focus {
            border-color: #2E8B57;
            box-shadow: 0 0 8px rgba(46, 139, 87, 0.5);
        }
        
        .submit-btn {
            padding: 12px 24px;
            font-size: 16px;
            background: linear-gradient(to bottom, #4CAF50, #2E8B57);
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .submit-btn:hover {
            background: linear-gradient(to bottom, #45a049, #26734d);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        
        .message {
            margin-top: 15px;
            font-size: 18px;
            color: #333;
            min-height: 24px;
            text-align: center;
            font-weight: bold;
        }
        
        .level-indicator {
            font-size: 24px;
            margin-bottom: 15px;
            font-weight: bold;
            color: #2E8B57;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            height: 20px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #4CAF50, #2E8B57);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
        }
        
        .instructions {
            background-color: #f1f8e9;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #4CAF50;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #2E8B57;
        }
        
        .jump-warrior {
            position: absolute;
            width: 150px;
            height: 200px;
            transition: transform 0.5s ease-in-out, left 2s ease-in-out, bottom 2s ease-in-out;
        }
        
        .jump-warrior img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .table-warrior {
            position: absolute;
            width: 120px;
            height: 180px;
            transition: left 2s ease-in-out;
            z-index: 10;
        }
        
        .table-warrior img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .chest-warrior {
            position: absolute;
            width: 150px;
            height: auto;
            transition: transform 0.3s ease;
        }
        
        .success-message {
            text-align: center;
            font-size: 28px;
            color: #2E8B57;
            margin: 20px 0;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Castle Treasure Hunt</h1>
            <div class="subtitle">Compound Directional Complement Practice</div>
        </header>
        
        <div class="game-area">
            <div class="progress-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            
            <div class="level-indicator" id="level-indicator">Level 1</div>
            
            <div class="instructions">
                <h3>How to Play:</h3>
                <p>Enter a Chinese sentence or command using directional complements to guide the warrior.</p>
            </div>
            
            <!-- Level 1 -->
            <div id="level1" class="tab-content active">
                <div class="game-container">
                    <img class="warrior" id="warrior1" src="images/warrior1.png" alt="Warrior">
                    <img class="castle" id="castle1" src="images/castle1.png" alt="Castle">
                </div>
                <div class="input-area">
                    <input type="text" class="answer-input" id="answer1" placeholder="Enter command (e.g. 走进去)">
                    <button class="submit-btn" id="submit1">Submit</button>
                </div>
                <div class="message" id="message1"></div>
            </div>
            
            <!-- Level 2 -->
            <div id="level2" class="tab-content" style="display: none;">
                <div class="game-container">
                    <img class="warrior" id="warrior2" src="images/warrior1.png" alt="Warrior">
                    <img class="staircase" id="staircase2" src="images/staircase2.png" alt="Staircase">
                </div>
                <div class="input-area">
                    <input type="text" class="answer-input" id="answer2" placeholder="Enter command (e.g. 走上去)">
                    <button class="submit-btn" id="submit2">Submit</button>
                </div>
                <div class="message" id="message2"></div>
            </div>
            
            <!-- Level 3 -->
            <div id="level3" class="tab-content" style="display: none;">
                <div class="game-container">
                    <img class="background" src="images/level3-bg.png" alt="Level 3 Background">
                    <img class="warrior" id="warrior3" src="images/warrior3.png" alt="Warrior">
                </div>
                <div class="input-area">
                    <input type="text" class="answer-input" id="answer3" placeholder="Enter command (e.g. 跑过去)">
                    <button class="submit-btn" id="submit3">Submit</button>
                </div>
                <div class="message" id="message3"></div>
            </div>
            
            <!-- Level 4 -->
            <div id="level4" class="tab-content" style="display: none;">
                <div class="game-container">
                    <div class="background" style="background-image: url('images/level4-bg.png'); background-size: contain; background-repeat: no-repeat; background-position: center;"></div>
                    <div class="jump-warrior" id="warrior4">
                        <img src="images/warrior4.png" alt="Warrior">
                    </div>
                </div>
                <div class="input-area">
                    <input type="text" class="answer-input" id="answer4" placeholder="Enter command (e.g. 跳起来)">
                    <button class="submit-btn" id="submit4">Execute</button>
                </div>
                <div class="message" id="message4"></div>
            </div>
            
            <!-- Level 5 -->
            <div id="level5" class="tab-content" style="display: none;">
                <div class="game-container">
                    <div class="background" style="background-image: url('images/level5-bg.png'); background-size: cover; background-position: center;"></div>
                    <div class="table-warrior" id="warrior5">
                        <img src="images/warrior5.png" alt="Warrior">
                    </div>
                </div>
                <div class="input-area">
                    <input type="text" class="answer-input" id="answer5" placeholder="Enter command (e.g. 走过去)">
                    <button class="submit-btn" id="submit5">Execute</button>
                </div>
                <div class="message" id="message5"></div>
            </div>
            
            <!-- Level 6 -->
            <div id="level6" class="tab-content" style="display: none;">
                <div class="game-container" id="game-container6">
                    <div class="background" style="background-image: url('images/level6-bg.png'); background-size: cover; background-position: center;"></div>
                    <img class="chest-warrior" id="warrior6" src="images/warrior6.png" alt="Warrior">
                </div>
                <div class="input-area">
                    <input type="text" class="answer-input" id="answer6" placeholder="Enter command (e.g. 拿出来)">
                    <button class="submit-btn" id="submit6">Execute</button>
                </div>
                <div class="message" id="message6"></div>
            </div>
            
            <!-- Completion Screen -->
            <div id="level-complete" class="tab-content" style="display: none;">
                <div class="success-message">Congratulations! You've completed all levels!</div>
                <div style="text-align: center;">
                    <img src="images/warrior6.png" alt="Warrior" style="width: 200px; height: auto;">
                </div>
                <div class="success-message">You are now a master of compound directional complements!</div>
            </div>
        </div>
    </div>

    <script>
        // 1. GAME DATA & LOGIC
        const levelLogic = {
            1: { targets: ['走进去', '跑进去'], verbs: ['走', '跑'], dir: '进', end: '去' },
            2: { targets: ['走上去', '跑上去'], verbs: ['走', '跑'], dir: '上', end: '去' },
            3: { targets: ['跑过去', '冲过去'], verbs: ['跑', '冲'], dir: '过', end: '去' },
            4: { targets: ['跳起来', '爬上去'], verbs: ['跳', '爬'], dir: ['起', '上'], end: ['来', '去'] },
            5: { targets: ['走过去', '跑过去'], verbs: ['走', '跑'], dir: '过', end: '去' },
            6: { targets: ['拿出来', '取出来'], verbs: ['拿', '取'], dir: '出', end: '来' }
        };

        const gameState = { currentLevel: 1, totalLevels: 6, completedLevels: 0 };

        // 2. THE AI FEEDBACK ENGINE
        function getFeedback(input, levelNum) {
            const val = input.trim();
            const logic = levelLogic[levelNum];

            // Success check
            if (logic.targets.some(t => val.includes(t))) return "SUCCESS";
            if (val === "") return "Please enter a command.";

            // Special Scaffolding for Level 4
            if (levelNum === 4) {
                if (val.includes("跳") && !val.includes("起来")) return "When jumping UP, use '起来'. Try '跳起来'!";
                if (val.includes("爬") && !val.includes("上去")) return "When climbing up and away, use '上去'. Try '爬上去'!";
                return "Try '跳起来' (jump up) or '爬上去' (climb up).";
            }

            // Component analysis
            const hasVerb = logic.verbs.some(v => val.includes(v));
            const hasDir = val.includes(logic.dir);
            const hasEnd = val.includes(logic.end);
            const wrongEnd = val.includes(logic.end === '来' ? '去' : '来');

            if (hasVerb && hasDir && wrongEnd) {
                return `Almost! But the warrior is moving ${logic.end === '去' ? 'away from' : 'toward'} you. Use '${logic.end}' instead of '${logic.end === '来' ? '去' : '来'}'.`;
            }
            if (hasVerb && hasDir && !hasEnd) {
                return `You have the action and direction! Now add '${logic.end}' to complete the perspective.`;
            }
            if (hasVerb && !hasDir) {
                return `Good verb! But you need the direction word '${logic.dir}'.`;
            }
            if (!hasVerb && (hasDir || hasEnd)) {
                return `You have the direction, but how is he moving? Add a verb like '${logic.verbs[0]}' or '${logic.verbs[1]}'.`;
            }

            return `Try the pattern: Verb + ${logic.dir} + ${logic.end}. (e.g. ${logic.targets[0]})`;
        }

        // 3. UI CONTROLS
        function updateProgressBar() {
            const progress = (gameState.completedLevels / gameState.totalLevels) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        function showNextLevel() {
            document.getElementById(`level${gameState.currentLevel}`).style.display = 'none';
            gameState.completedLevels++;
            updateProgressBar();
            if (gameState.currentLevel < gameState.totalLevels) {
                gameState.currentLevel++;
                document.getElementById(`level${gameState.currentLevel}`).style.display = 'block';
                document.getElementById('level-indicator').textContent = `Level ${gameState.currentLevel}`;
            } else {
                document.getElementById('level-complete').style.display = 'block';
                document.getElementById('level-indicator').textContent = 'Completed!';
            }
        }

        // 4. LEVEL SPECIFIC ACTIONS
        // Level 1
        const warrior1 = document.getElementById('warrior1');
        warrior1.style.left = '50px'; warrior1.style.top = '250px';
        document.getElementById('submit1').onclick = () => {
            const fb = getFeedback(document.getElementById('answer1').value, 1);
            const msg = document.getElementById('message1');
            if (fb === "SUCCESS") {
                msg.textContent = 'Correct! The warrior entered the castle!';
                msg.style.color = "#2E8B57";
                warrior1.style.left = '550px';
                setTimeout(showNextLevel, 4500);
            } else { msg.textContent = fb; msg.style.color = "#b21f1f"; }
        };

        // Level 2
        const warrior2 = document.getElementById('warrior2');
        const staircase2 = document.getElementById('staircase2');
        warrior2.style.left = '50px'; warrior2.style.bottom = '100px'; staircase2.style.display = 'block';
        document.getElementById('submit2').onclick = () => {
            const fb = getFeedback(document.getElementById('answer2').value, 2);
            const msg = document.getElementById('message2');
            if (fb === "SUCCESS") {
                msg.textContent = 'Excellent! The warrior went up the stairs!';
                msg.style.color = "#2E8B57";
                warrior2.style.left = '600px'; warrior2.style.bottom = '200px';
                setTimeout(showNextLevel, 4500);
            } else { msg.textContent = fb; msg.style.color = "#b21f1f"; }
        };

        // Level 3
        const warrior3 = document.getElementById('warrior3');
        warrior3.style.left = '50px'; warrior3.style.bottom = '100px';
        document.getElementById('submit3').onclick = () => {
            const fb = getFeedback(document.getElementById('answer3').value, 3);
            const msg = document.getElementById('message3');
            if (fb === "SUCCESS") {
                msg.textContent = 'Correct! The warrior ran to the cabinet!';
                msg.style.color = "#2E8B57";
                warrior3.style.left = '850px';
                setTimeout(showNextLevel, 4500);
            } else { msg.textContent = fb; msg.style.color = "#b21f1f"; }
        };

        // Level 4
        const warrior4 = document.getElementById('warrior4');
        warrior4.style.left = '150px'; warrior4.style.bottom = '100px';
        document.getElementById('submit4').onclick = async () => {
            const val = document.getElementById('answer4').value;
            const fb = getFeedback(val, 4);
            const msg = document.getElementById('message4');
            if (fb === "SUCCESS") {
                msg.textContent = 'Action executed!'; msg.style.color = "#2E8B57";
                if(val.includes("跳")) {
                    warrior4.style.transform = 'translateY(-150px)';
                    setTimeout(() => warrior4.style.transform = 'translateY(0)', 500);
                } else {
                    warrior4.style.bottom = "250px"; warrior4.style.left = "400px";
                }
                setTimeout(showNextLevel, 3000);
            } else { msg.textContent = fb; msg.style.color = "#b21f1f"; }
        };

        // Level 5
        const warrior5 = document.getElementById('warrior5');
        warrior5.style.left = '220px'; warrior5.style.bottom = '60px';
        document.getElementById('submit5').onclick = () => {
            const fb = getFeedback(document.getElementById('answer5').value, 5);
            const msg = document.getElementById('message5');
            if (fb === "SUCCESS") {
                msg.textContent = 'Correct! The warrior reached the table!';
                msg.style.color = "#2E8B57";
                warrior5.style.left = '750px';
                setTimeout(showNextLevel, 4500);
            } else { msg.textContent = fb; msg.style.color = "#b21f1f"; }
        };

        // Level 6
        const warrior6 = document.getElementById('warrior6');
        warrior6.style.left = '50px'; warrior6.style.bottom = '120px';
        document.getElementById('submit6').onclick = () => {
            const fb = getFeedback(document.getElementById('answer6').value, 6);
            const msg = document.getElementById('message6');
            if (fb === "SUCCESS") {
                msg.textContent = 'Correct! You found the treasure!';
                msg.style.color = "#2E8B57";
                createConfetti();
                warrior6.style.transform = 'scale(1.2)';
                setTimeout(showNextLevel, 4500);
            } else { msg.textContent = fb; msg.style.color = "#b21f1f"; }
        };

        // Confetti helper
        function createConfetti() {
            const container = document.getElementById('game-container6');
            for (let i = 0; i < 100; i++) {
                const c = document.createElement('div');
                c.className = 'confetti';
                c.style.backgroundColor = ['#ff0', '#f0f', '#0ff', '#f00'][Math.floor(Math.random()*4)];
                c.style.left = Math.random() * 100 + '%';
                c.style.top = '-10px';
                c.style.width = '10px'; c.style.height = '10px';
                c.style.position = 'absolute';
                c.style.opacity = '1';
                container.appendChild(c);
                c.animate([
                    { transform: `translateY(0) rotate(0deg)`, opacity: 1 },
                    { transform: `translateY(500px) rotate(720deg)`, opacity: 0 }
                ], { duration: 2000 + Math.random() * 3000, easing: 'ease-out' }).onfinish = () => c.remove();
            }
        }

        // Initialize Enter keys
        document.querySelectorAll('.answer-input').forEach((input, i) => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') document.getElementById(`submit${i+1}`).click();
            });
        });

        updateProgressBar();
    </script>
</body>
</html>
